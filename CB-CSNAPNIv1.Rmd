---
title: "CB-CSNAPNIv1"
author: "Lucas de Lima Casseres"
date: "2023-04-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#fig_setup.R
source("FigureSubs/commodity_colorbank.r")
year_labels = c(1997,2002,2007,2012,2017)
crop_labels = c("corn grain","corn silage","wheat","oats","barley","sorghum grain","sorghum silage",
                "potatoes","rye","alfalfa hay","other hay","soybeans","cropland pasture","noncropland pasture",
                "rice","peanuts","CGF","CGM","DGS")
meat_labels = c("beef","dairy","swine","sheep","horse","layers","broilers",
                "turkey","goats")
corn_labels = c("Corn not used for ethanol","Corn for dry milling","Corn for wet milling")
NANI_labels = c("Atm N Dep", "Fix N", "Fert N", "Net Food and Feed Imports")
```


```{r}
## This script assigns colors to data categories. It was originally just for commodities, but now it's also for the broader NANI and NAPI contributions

#NANI/NAPI
atmdep = rgb(200/260, 220/260, 254/260) #bluish
biofix = rgb(150/260, 200/260, 10/260) #greenish
agfert = rgb(0.9,0.223,0.180) #redish
nff = rgb(160/260, 39/260, 185/260) #purple, net food and feed
nagfert = rgb(255/260, 255/260, 130/260) #yellow
nffert = rgb(209/260, 165/260, 138/260) #tan, non food fertilizer
det = rgb(255/260, 140/260, 0/260) #orange
P_diet_supp = "#ADCCF6" #light blue

#NANI
NANI_colors = c(atmdep,biofix,agfert,nff,nagfert,nffert)

#NAPI
NAPI_colors = c(agfert,nff,nagfert,nffert,det,P_diet_supp)

#crop commodities
corn = rgb(255/260, 46/260, 67/260) #corn
csilage = rgb(224/300, 67/300, 117/300) #corn silage
wheat = rgb(225/260, 245/260, 254/260) #wheat
oats = rgb(156/260, 39/260, 176/260) #oats
barley = rgb(240/240, 120/240, 146/240) #barley
sorghum = rgb(25/260, 118/260, 210/260) #sorghum
ssilage = rgb(144/260, 202/260, 249/260) #sorghum silage
potatoes = rgb(255/260, 255/260, 141/260) #potatoes
rye = rgb(199/260, 0/260, 57/260) #rye
ahay = rgb(214/260, 183/260, 92/260) #alfalfa hay
nahay = rgb(158/260, 124/260, 22/260) #non alfalfa
soy = rgb(255/260, 182/260, 38/260) #soybeans
cpasture = rgb(127/260, 81/260, 52/260) #cropland pasture
ncpasture = rgb(209/260, 165/260, 138/260) #non cropland
rice = rgb(239/260, 235/260, 233/260) #rice
peanuts = rgb(109/260, 76/260, 65/260) #peanuts
CGF = rgb(244/260, 115/260, 106/260) #CGF
CGM = rgb(244/260, 147/260, 141/260) #CGM
DGS = rgb(244/260, 185/260, 181/260) #DGS
etoh = rgb(247/260, 29/260, 127/260) #ethanol

crop_colors = c(corn,csilage,wheat,oats,barley,sorghum,ssilage,potatoes,rye,ahay,nahay,soy,cpasture,ncpasture,rice,peanuts,CGF,CGM,DGS,etoh)
```


## Results
### 1. NANI
```{r NANItotals_plot,echo=FALSE,fig.width=15,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 1.1: Net Anthropogenic Nitrogen Input (NANI) totals for the US.** Results shown are from the commodity-specific NANI (CSNANI) model.*"}
positives1 <- negatives1 <- NANIBtot_US
positives1[positives1<0] <- 0
negatives1[negatives1>0] <- 0
# positives2 <- negatives2 <- NANIorigtot_US
# positives2[positives2<0] <- 0
# negatives2[negatives2>0] <- 0
# myrange <- c(min(c(colSums(negatives1),colSums(negatives2)))-1,max(c(colSums(positives1),colSums(positives2)))+1)
myrange <- c(min(colSums(negatives1))-0.1,max(colSums(positives1))+10)

par(mai=c(1, 3.6, 1, 0.4), xpd=TRUE, mfrow=c(1,2))
barplot(positives1,
        main="a) CB-CSNANI",
        ylab="N (10^6 kg)",
        col=NANI_colors,
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
        ylim=myrange, bty='L', width = 1, space = 0.5)
barplot(negatives1,add=TRUE,ylim=rev(myrange),col=NANI_colors, width = 1, space = 0.5)
axis(2)
box()
legend("topright", inset=c(1.3,0), legend=c("atmospheric deposition","biological fixation","fertilizer for food","net food and feed imports","non-ag fertilizer","non-food fertilizer"), fill=NANI_colors)

# par(mai=c(1, 1, 1, 3), xpd=TRUE)
# myrange <- c(min(c(colSums(negatives1),colSums(negatives2)))-1,max(c(colSums(positives1),colSums(positives2)))+1)
# barplot(positives2,
#         main="b) VB NANI Toolbox",
#         ylab="N (10^3 kg)",
#         col=NANI_colors,
#         axes=FALSE,
#         names.arg = year_labels,
#         cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
#         ylim=myrange, bty='L', width = 1, space = 0.5)
# barplot(negatives2,add=TRUE,ylim=rev(myrange),col=NANI_colors, width = 1, space = 0.5)
# axis(2)
# box()
```

<br>
<br>
<br>
```{r NANI_wsspec_plot,echo=FALSE,fig.width=11,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 1.2: Watershed specific NANI totals** Using new NANI.*"}
for(n in 1:nyrs){
  NANI_wsspec[,n] = colSums(NANIBtot[ws,,n])/(10^3)
}
positives <- negatives <- NANI_wsspec
positives[positives<0] <- 0
negatives[negatives>0] <- 0
myrange <- c(min(colSums(negatives))-1,max(colSums(positives))+1)
par(mai=c(1, 1, 1, 4), xpd=TRUE)
barplot(positives,
      main="NANI for selected watersheds",
      ylab="N (10^3 kg)",
      col=NANI_colors,
      axes=FALSE,
      names.arg = year_labels,
      cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
      ylim=myrange, bty='L', width = 1, space = 0.5)
barplot(negatives,add=TRUE,ylim=rev(myrange),col=NANI_colors, width = 1, space = 0.5)
axis(2)
box()
legend("topright", inset=c(-0.42,0), legend=c("atmospheric deposition","biological fixation","agricultural fertilizer","net food and feed imports","domestic fertilizer","non-food fertilizer"), fill=NANI_colors)
```
<br>
<br>
<br>
```{r fertandfixN_plot,echo=FALSE,fig.width=15,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 1.3: Total commodity-disaggregated fertilizer (a) and fixation (b) inputs for selected watersheds.***"}
par(mai=c(1, 3.6, 1, 0.4), xpd=TRUE,mfrow=c(1,2))
barplot(t(total_commoddisag_fertN),
        main="a) fertilizer N",
        ylab="N (10^6 kg)",
        col=crop_colors,
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=2, cex.main=2, cex.names = 1,
        ylim=c(0,180), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
legend("topright", inset=c(1.4,0), legend=c(crop_labels,"ethanol"),  fill=crop_colors)

par(mai=c(1, 1, 1, 3), xpd=TRUE)
barplot(total_commoddisag_fixN,
        main="b) fixation N",
        ylab="N (10^6 kg)",
        col=crop_colors,
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=2, cex.main=2, cex.names = 1,
        ylim=c(0,180), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
```
<br>
<br>
<br>
```{r etohNperL_plot,echo=FALSE,fig.width=11,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 1.4: Fertilizer N inputs per liter of ethanol fuel from 1987-2012.** This estimate excludes N inputs allocated to ethanol coproducts. Decreasing N inputs per liter from 1997-2007 are driven by improved corn to ethanol conversion efficiency and reduced N inputs per mass of corn. The increase in 2012 resulted from drought conditions and reduced corn yield.*"}
par(mai=c(1, 1, 1, 1), xpd=TRUE)
barplot(unitfertNetoh*10^3,
        main="Fertilizer N inputs per liter of ethanol fuel",
        ylab="g N / L ethanol",
        col=crop_colors[20],
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
        ylim=c(0,80), bty='L', width = 1, space = 0.5)
axis(2)
box()
```

```{r echo=FALSE, results = 'asis'}
library(knitr)
unitfertNetoh_df = data.frame(unitfertNetoh*10^3)
rownames(unitfertNetoh_df) = year_labels
kable(unitfertNetoh_df, caption = "Figure 1.4: Fertilizer N inputs per liter of ethanol fuel from 1987-2012. This estimate excludes N inputs allocated to ethanol coproducts. Decreasing N inputs per liter from 1997-2007 are driven by improved corn to ethanol conversion efficiency and reduced N inputs per mass of corn. The increase in 2012 resulted from drought conditions and reduced corn yield.")
```
<br>
<br>
<br>
```{r meatNperprot_plot,echo=FALSE,fig.width=20,fig.height=15,fig.cap="\\label{fig:Rn`}**Figure 1.5: Fertilizer and Fixation N inputs to animal feeds per kg protein in animal food products from 1997-2012.** Other grains are CGF, CGM, wheat, barley, sorghum, and rye. CGF, CGM, and DGS stand for corn gluten feed, corn gluten meal, and distiller’s grains and solubles, respectively."}
year_range = 1:5
par(mai=c(0.5, 4, 0.5, 0.25), xpd=TRUE, mfrow=c(3,2))
meat_type=1 #beef
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="a) beef",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,2.5), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
legend(cex=2.1,"topright", inset=c(1.18,0), legend=c(crop_labels[major_feeds_for_beef],"other grains"),  fill=c(crop_colors[major_feeds_for_beef],"white"))
#Other grains = CGF, CGM, Wheat, Barley, Sorghum, Rye

par(mai=c(0.5, 0.75, 0.5, 3.6))
meat_type=3 #pork
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="b) pork",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,2.5), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 4, 0.5, 0.25))
meat_type=2 #milk
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="c) milk",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,1.8), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 3.6))
meat_type=6 #eggs
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="d) eggs",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,1.8), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 4, 0.5, 0.25))
meat_type=7 #chicken
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="e) chicken",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,1.8), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 3.6))
meat_type=8 #turkey
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Nimpacts_major_feeds=fertNperMprot[meat_type,major_feeds_for_beef,year_range]+fixNperMprot[meat_type,major_feeds_for_beef,year_range]
Nimpacts_minor_feeds=colSums(fertNperMprot[meat_type,minor_feeds_for_beef,year_range])+colSums(fixNperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
barplot(rbind(Nimpacts_major_feeds,Nimpacts_minor_feeds), #N requirements of meat products over time
        main="f) turkey",
        ylab="kg N input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white"),
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,1.8), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
```
<br>
<br>
<br>

### 2. NAPI
```{r NAPItotals_plot,echo=FALSE,fig.width=15,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 2.1: Net Anthropogenic Phosphorus Input (NAPI) totals for the US.** Results shown are from the commodity-specific NAPI (CSNAPI) model.*"}
positives1 <- negatives1 <- NAPIBtot_US
positives1[positives1<0] <- 0
negatives1[negatives1>0] <- 0
# positives2 <- negatives2 <- NAPIorigtot_US
# positives2[positives2<0] <- 0
# negatives2[negatives2>0] <- 0
# myrange <- c(min(c(colSums(negatives1),colSums(negatives2))-0.1),max(c(colSums(positives1),colSums(positives2)))+0.5)
myrange <- c(min(colSums(negatives1))-0.1,max(colSums(positives1))+0.5)

par(mai=c(1, 1, 1, 4), xpd=TRUE) #, mfrow=c(1,2))
barplot(positives1,
        main="CSNAPI",
        ylab="P (10^6 kg)",
        col=NAPI_colors,
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.main=1.5, cex.names = 1.1,
        ylim=myrange, bty='L', width = 1, space = 0.5)
barplot(negatives1,add=TRUE,axes=FALSE,ylim=rev(myrange),col=NAPI_colors, width = 1, space = 0.5)
axis(2, cex.axis = 1.1)
box()
legend("topright", inset=c(1.3,0), legend=c("fertilizer for food","net food and feed imports","non-ag fertilizer","non-food fertilizer","detergent","animal diet supplements"),  fill=NAPI_colors)

# par(mai=c(1, 1, 1, 3), xpd=TRUE)
# barplot(positives2,
#         main="VB NAPI Toolbox",
#         ylab="P (10^3 kg)",
#         col=NAPI_colors,
#         axes=FALSE,
#         names.arg = year_labels,
#         cex.lab=1.5, cex.main=1.5, cex.names = 1.2,
#         ylim=myrange, bty='L', width = 1, space = 0.5)
# barplot(negatives2,add=TRUE,axes=FALSE,ylim=rev(myrange),col=NAPI_colors, width = 1, space = 0.5)
# axis(2, cex.axis = 1.2)
# box()
```
<br>
<br>
<br>
```{r fertP_plot,echo=FALSE,fig.width=11,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 2.2: Total commodity-disagreggated fertilizer inputs for selected watersheds.***"}
par(mai=c(1, 1, 1, 4), xpd=TRUE)
barplot(t(total_commoddisag_fertP),
        main="Fertilizer P: Total commodity-disaggregated inputs",
        ylab="P (10^3 kg)",
        col=crop_colors,
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
        ylim=c(0,2), bty='L', width = 1, space = 0.5)
axis(2)
box()
legend("topright", inset=c(-0.37,0), legend=c(crop_labels,"Ethanol"),  fill=crop_colors)
```
<br>
<br>
<br>
```{r etohPperL_plot,echo=FALSE,fig.width=11,fig.height=8,fig.cap="\\label{fig:Rn`}***Figure 2.3: Fertilizer P inputs per liter of ethanol fuel from 1987-2012.** This estimate excludes P inputs allocated to ethanol coproducts.*"}
par(mai=c(1, 1, 1, 1), xpd=TRUE)
barplot(unitfertPetoh*10^3,
        main="Fertilizer P inputs per liter of ethanol fuel",
        ylab="g P / L ethanol",
        col=crop_colors[20],
        axes=FALSE,
        names.arg = year_labels,
        cex.lab=1.5, cex.axis=1.5, cex.main=1.5,
        ylim=c(0,7), bty='L', width = 1, space = 0.5)
axis(2)
box()
```
<br>
<br>
<br>
```{r meatPperprot_plot,echo=FALSE,fig.width=20,fig.height=20,fig.cap="\\label{fig:Rn`}**Figure 2.4: Fertilizer and mineral P inputs to animal feeds per kg protein in animal food products from 1997-2012.** Other grains are CGF, CGM, wheat, barley, sorghum, and rye. CGF, CGM, and DGS stand for corn gluten feed, corn gluten meal, and distiller’s grains and solubles, respectively."}
y_max = 0.5
P_supp_color = "#ADCCF6" #light blue
year_range = 1:5
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
yaxis_font_size = 2
xaxis_font_size = 2.5
ylab_font_size = 2.5

par(mai=c(0.5, 5, 0.5, 0.25), xpd=TRUE, mfrow=c(3,2))
meat_type=1 #beef
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
beefPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
beef_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="a) beef",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()
legend(cex=2.5,"topright", inset=c(1.18,0), legend=c(crop_labels[major_feeds_for_beef], "other grains","diet supplements"),  fill=c(crop_colors[major_feeds_for_beef],"white",P_supp_color))
#Other grains = CGF, CGM, Wheat, Barley, Sorghum, Rye

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=3 #pork
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
porkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
pork_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="b) pork",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=2 #milk
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
milkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
milk_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="c) milk",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=6 #eggs
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
eggsPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
eggs_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="d) eggs",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=7 #chicken
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
chickenPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
chicken_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="e) chicken",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=8 #turkey
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)
Pimpacts_major_feeds=fertPperMprot[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMprot[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perprot[meat_type,year_range]
turkeyPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
turkey_df = data.frame(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp), #N requirements of meat products over time
        main="f) turkey",
        ylab="kg P input / kg protein",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=ylab_font_size, cex.axis=3, cex.main=3, cex.names = xaxis_font_size,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2, cex.axis=yaxis_font_size)
box()
```

```{r meatPperkcal_plot,echo=FALSE,fig.width=20,fig.height=20,fig.cap="\\label{fig:Rn`}**Figure 2.5: Fertilizer and mineral P inputs to animal feeds per kcal in animal food products from 1997-2012.** Other grains are CGF, CGM, wheat, barley, sorghum, and rye. CGF, CGM, and DGS stand for corn gluten feed, corn gluten meal, and distiller’s grains and solubles, respectively."}
y_max = .03
P_supp_color = "#ADCCF6" #light blue
year_range = 1:5
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)

par(mai=c(0.5, 5, 0.5, 0.25), xpd=TRUE, mfrow=c(3,2))
meat_type=1 #beef
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
beefPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="a) beef",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
legend(cex=2.1,"topright", inset=c(1.18,0), legend=c(crop_labels[major_feeds_for_beef], "other grains","diet supplements"),  fill=c(crop_colors[major_feeds_for_beef],"white",P_supp_color))
#Other grains = CGF, CGM, Wheat, Barley, Sorghum, Rye

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=3 #pork
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
porkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="b) pork",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=2 #milk
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
milkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="c) milk",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=6 #eggs
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
eggsPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="d) eggs",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=7 #chicken
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
chickenPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="e) chicken",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=8 #turkey
Pimpacts_major_feeds=fertPperMkcal[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPperMkcal[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_perkcal[meat_type,year_range]
turkeyPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp)*10^3,
        main="f) turkey",
        ylab="g P input / kcal",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
```

```{r meatPperkgmeat_plot,echo=FALSE,fig.width=20,fig.height=20,fig.cap="\\label{fig:Rn`}**Figure 2.6: Fertilizer and mineral P inputs to animal feeds per kg animal food product from 1997-2012.** Other grains are CGF, CGM, wheat, barley, sorghum, and rye. CGF, CGM, and DGS stand for corn gluten feed, corn gluten meal, and distiller’s grains and solubles, respectively."}
y_max = .1
P_supp_color = "#ADCCF6" #light blue
year_range = 1:5
major_feeds_for_beef=c(10:11,13:14,12,1:2,19) #reordered to keep grains and forage together
minor_feeds_for_beef=c(3:9,15:18)

par(mai=c(0.5, 5, 0.5, 0.25), xpd=TRUE, mfrow=c(3,2))
meat_type=1 #beef
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
beefPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="a) beef",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
legend(cex=2.1,"topright", inset=c(1.18,0), legend=c(crop_labels[major_feeds_for_beef], "other grains","diet supplements"),  fill=c(crop_colors[major_feeds_for_beef],"white",P_supp_color))
#Other grains = CGF, CGM, Wheat, Barley, Sorghum, Rye

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=3 #pork
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
porkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="b) pork",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=2 #milk
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
milkPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="c) milk",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=6 #eggs
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
eggsPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="d) eggs",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 5, 0.5, 0.25))
meat_type=7 #chicken
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
chickenPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="e) chicken",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()

par(mai=c(0.5, 0.75, 0.5, 4.6))
meat_type=8 #turkey
Pimpacts_major_feeds=fertPpermeat[meat_type,major_feeds_for_beef,year_range]
Pimpacts_minor_feeds=colSums(fertPpermeat[meat_type,minor_feeds_for_beef,year_range]) #this combines the minor feeds into a single category
Psupp = Psupp_permeat[meat_type,year_range]
turkeyPinputstotal = colSums(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp))
barplot(rbind(Pimpacts_major_feeds,Pimpacts_minor_feeds,Psupp),
        main="f) turkey",
        ylab="kg P input / kg product",
        col=c(crop_colors[major_feeds_for_beef],"white",P_supp_color),
        axes=FALSE,
        names.arg = year_labels[year_range],
        cex.lab=2, cex.axis=3, cex.main=3, cex.names = 2,
        ylim=c(0,y_max), bty='L', width = 1, space = 0.5)
axis(2,cex.axis=1.5)
box()
```

